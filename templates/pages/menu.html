
{% extends 'pages/index.html' %}
{% block title %}
  <title>Tableau de Bords</title>
{% endblock %}
  {% block content %}
  <div class="content-body">
   
    <div class="container pd-x-0 pd-lg-x-10 pd-xl-x-0">
      <div class="row row-xs">
            <div class="col-lg-8">
              <div class="card">
                <div class="card-header d-sm-flex justify-content-between bd-b-0 pd-t-20 pd-b-0">
                  <div class="mg-b-10 mg-sm-b-0">
                    <h6 class="mg-b-5">Current Ticket Status</h6>
                    <p class="tx-12 tx-color-03 mg-b-0">as of 10th to 17th of March 2023</p>
                  </div>
                  <ul class="list-inline tx-uppercase tx-10 tx-medium tx-spacing-1 tx-color-03 mg-b-0">
                    <li class="list-inline-item">
                      <span class="d-inline-block wd-7 ht-7 bg-gray-400 rounded-circle mg-r-5"></span>
                      New<span class="d-none d-md-inline"> Tickets</span>
                    </li>
                    <li class="list-inline-item mg-l-10">
                      <span class="d-inline-block wd-7 ht-7 bg-df-2 rounded-circle mg-r-5"></span>
                      Solved<span class="d-none d-md-inline"> Tickets</span>  
                    </li>
                    <li class="list-inline-item mg-l-10">
                      <span class="d-inline-block wd-7 ht-7 bg-primary rounded-circle mg-r-5"></span>
                      Open<span class="d-none d-md-inline"> Tickets</span>
                    </li>
                  </ul>
                </div>
                <div class="card-body">
                  <div class="chart-fifteen">
                    <div id="flotChart1" class="flot-chart"></div>
                  </div>
                </div><!-- card-body -->
                <div class="card-footer pd-y-15 pd-x-20">
                  <div class="row row-sm">
                    <div class="col-6 col-sm-4 col-md-3 col-lg">
                      {% if current_user.role.role == "Agent" or current_user.role.role == "Collaborateur" %}
                        {% for agent in agents %}
                          {% if current_user.nom_abrege == agent.agent_nom_abrege %}
                            <h4 class="tx-normal tx-rubik mg-b-10">{{ agent.total_tickets }} </h4>
                          {% endif %}
                        {% endfor %}
                      {% elif current_user.role.role == "Chef de Service" %}
                        {% for tt in  total_tickets_traites_ser %}
                        <!-- {{ tt }} -->
                          {% if current_user.service.nom == tt.service_nom %}
                              <h4 class="tx-normal tx-rubik mg-b-10">{{ tt.total_tickets }}</h4>
                          {% endif %}
                        {% endfor %}
                      {% elif current_user.role.role == "Chef de département" %}
                        <h4 class="tx-normal tx-rubik mg-b-10">{{ total_tickets }}</h4>
                      {% endif %}
                      <div class="progress ht-2 mg-b-10">
                        <div class="progress-bar wd-100p bg-df-2" role="progressbar" aria-valuenow="100" aria-valuemin="0" aria-valuemax="100"></div>
                      </div>
                      <h6 class="tx-uppercase tx-spacing-1 tx-semibold tx-10 tx-color-02 mg-b-2">New Tickets</h6>
                      <p class="tx-10 tx-color-03 mg-b-0"><span class="tx-medium tx-success d-inline-flex align-items-center">1.2% <ion-icon name="arrow-up-outline" class="mg-b-1"></ion-icon></span> than yesterday</p>
                    </div><!-- col -->
                    <div class="col-6 col-sm-4 col-md-3 col-lg">
                      {% if current_user.role.role == "Agent" or current_user.role.role == "Collaborateur" %}
                        <h4 class="tx-normal tx-rubik mg-b-10">{{ Ticket_solved_user }}</h4>
                      {% elif current_user.role.role == "Chef de Service" %}
                        {% for tt in  total_tickets_traites_ser %}
                        <!-- {{ tt }} -->
                          {% if current_user.service.nom == tt.service_nom %}
                              <h4 class="tx-normal tx-rubik mg-b-10">{{ tt.total_tickets_traites }}</h4>
                          {% endif %}
                        {% endfor %}
                      {% elif current_user.role.role == "Chef de département" %}
                        <h4 class="tx-normal tx-rubik mg-b-10">{{ total_tickets_traites }}</h4>
                      {% endif %}
                      <div class="progress ht-2 mg-b-10">
                        <div class="progress-bar wd-85p bg-df-2" role="progressbar" aria-valuenow="85" aria-valuemin="0" aria-valuemax="100"></div>
                      </div>
                      <h6 class="tx-uppercase tx-spacing-1 tx-semibold tx-10 tx-color-02 mg-b-2">Solved Tickets</h6>
                      <p class="tx-10 tx-color-03 mg-b-0"><span class="tx-medium tx-danger d-inline-flex align-items-center">-0.6% <ion-icon name="arrow-down-outline" class="mg-b-1"></ion-icon></span> than yesterday</p>
                    </div><!-- col -->
                    <div class="col-6 col-sm-4 col-md-3 col-lg mg-t-20 mg-sm-t-0">
                      {% if current_user.role.role == "Agent" or current_user.role.role == "Collaborateur" %}
                      <h4 class="tx-normal tx-rubik mg-b-10">{{ Ticket_non_solved_user }}</h4>
                      {% elif current_user.role.role == "Chef de Service" %}
                      <h4 class="tx-normal tx-rubik mg-b-10">{{ Ticket_non_solved_service }}</h4>
                      {% elif current_user.role.role == "Chef de département" %}
                      <h4 class="tx-normal tx-rubik mg-b-10">{{ Ticket_non_solved }}</h4>
                      {% endif %}

                      <div class="progress ht-2 mg-b-10">
                        <div class="progress-bar wd-25p bg-df-2" role="progressbar" aria-valuenow="25" aria-valuemin="0" aria-valuemax="100"></div>
                      </div>
                      <h6 class="tx-uppercase tx-spacing-1 tx-semibold tx-10 tx-color-02 mg-b-2">Unresolved</h6>
                      <p class="tx-10 tx-color-03 mg-b-0"><span class="tx-medium tx-success d-inline-flex align-items-center">0.3% <ion-icon name="arrow-up-outline" class="mg-b-1"></ion-icon></span> than yesterday</p>
                    </div><!-- col -->
                    <div class="col-6 col-sm-4 col-md-3 col-lg mg-t-20 mg-md-t-0">
                      {% if current_user.role.role == "Chef de Service" or current_user.role.role == "Agent" or current_user.role.role == "Collaborateur" %}
                        {% for nqi in nqi_services %}
                        <!-- {{ nqi}} -->
                          {% if current_user.nom_abrege == nqi.agent_nom_abrege %}
                            <h4 class="tx-normal tx-rubik mg-b-10">{{ nqi.note_qualite_interne*100|round(1) }}%</h4>
                          {% endif %}
                        {% endfor %}
                      {% elif current_user.role.role == "Chef de département" %}
                        {% if nqi_dep is not none and nqi_dep[0][0] is not none %}
                          <h4 class="tx-normal tx-rubik mg-b-10">{{ (nqi_dep[0][0]|round(2))*100 }}%</h4>
                        {% else %}
                          <p>N/A</p>
                        {% endif %}
                      {% endif %}
                      <div class="progress ht-2 mg-b-10">
                        <div class="progress-bar wd-45p bg-df-2" role="progressbar" aria-valuenow="45" aria-valuemin="0" aria-valuemax="100"></div>
                      </div>
                      <h6 class="tx-uppercase tx-spacing-1 tx-semibold tx-10 tx-color-02 mg-b-2">Note Qualité Interne</h6>
                      <p class="tx-10 tx-color-03 mg-b-0"><span class="tx-medium tx-success d-inline-flex align-items-center">0.3% <ion-icon name="arrow-up-outline" class="mg-b-1"></ion-icon></span> than yesterday</p>
                    </div><!-- col -->
                    <div class="col-6 col-sm-4 col-md-3 col-lg mg-t-20 mg-lg-t-0">
                      <h4 class="tx-normal tx-rubik mg-b-10">30</h4>
                      <div class="progress ht-2 mg-b-10">
                        <div class="progress-bar wd-30p bg-df-2" role="progressbar" aria-valuenow="30" aria-valuemin="0" aria-valuemax="100"></div>
                      </div>
                      <h6 class="tx-uppercase tx-spacing-1 tx-semibold tx-10 tx-color-02 mg-b-2">Unassigned</h6>
                      <p class="tx-10 tx-color-03 mg-b-0"><span class="tx-medium tx-success d-inline-flex align-items-center">0.3% <ion-icon name="arrow-up-outline" class="mg-b-1"></ion-icon></span> than yesterday</p>
                    </div><!-- col -->
                  </div><!-- row -->
                </div><!-- card-footer -->
              </div><!-- card -->
              <div class="row row-xs mg-t-10">
                <div class="col-md-7">
                  <div class="card">
                    <div class="card-header pd-b-0 pd-t-20 bd-b-0">
                      <h6 class="mg-b-0">Tickets By Request Type</h6>
                    </div><!-- card-header -->
                    <div class="card-body">
                      <div class="chart-seventeen"><canvas id="chartBar2"></canvas></div>
                    </div><!-- card-body -->
                  </div><!-- card -->
                </div>
                <div class="col-md-5 mg-t-10 mg-md-t-0">
                  <div class="card">
                    <div class="card-header pd-b-0 pd-t-20 bd-b-0">
                      <h6 class="mg-b-0">Satisfaction Département</h6>
                    </div><!-- card-header -->
                    <div class="card-body pd-y-10">
                      <div class="d-flex align-items-baseline tx-rubik">
                        {% if current_user.role.role == "Chef de Service" %}
                            {% for service in service %}
                            {% if service.service_nom == current_user.service.nom  %}
                            <h1 class="tx-40 lh-1 tx-normal tx-spacing--2 mg-b-5 mg-r-5">{{ (service.note_qualite_interne*100)|round(1) }}</h1>
                            {% endif %}
                            <!-- <h1 class="tx-40 lh-1 tx-normal tx-spacing--2 mg-b-5 mg-r-5">9.8</h1> -->
                            {% endfor %}
                        {% elif current_user.role.role == "Agent" or current_user.role.role == "Collaborateur" %}
                            {% for service in agents %}
                              {% if service.agent_nom_abrege == current_user.nom_abrege  %}
                              <h1 class="tx-40 lh-1 tx-normal tx-spacing--2 mg-b-5 mg-r-5">{{ (service.note_qualite_interne*100)|round(1) }}</h1>
                              {% endif %}
                            {% endfor %}
                        {% elif current_user.role.role == "Chef de département" %}
                          {% if nqi_dep is not none and nqi_dep[0][0] is not none %}
                            <h4 class="tx-normal tx-rubik mg-b-10">{{ (nqi_dep[0][0]|round(2))*100 }}%</h4>
                          {% else %}
                            <p>N/A</p>
                          {% endif %}
                        {% endif %}
                        <p class="tx-11 tx-color-03 mg-b-0"><span class="tx-medium tx-success d-inline-flex align-items-center">1.6% <ion-icon name="arrow-up-outline"></ion-icon></span></p>
                      </div>
                      <h6 class="tx-uppercase tx-spacing-1 tx-semibold tx-10 tx-color-02 mg-b-15">Performance Score</h6>

                      <div class="progress bg-transparent op-7 ht-10 mg-b-15">
                        <div class="progress-bar bg-primary wd-50p" role="progressbar" aria-valuenow="30" aria-valuemin="0" aria-valuemax="100"></div>
                        <div class="progress-bar bg-success wd-25p bd-l bd-white" role="progressbar" aria-valuenow="15" aria-valuemin="0" aria-valuemax="100"></div>
                        <div class="progress-bar bg-warning wd-5p bd-l bd-white" role="progressbar" aria-valuenow="5" aria-valuemin="0" aria-valuemax="100"></div>
                        <div class="progress-bar bg-pink wd-5p bd-l bd-white" role="progressbar" aria-valuenow="5" aria-valuemin="0" aria-valuemax="100"></div>
                        <div class="progress-bar bg-teal wd-10p bd-l bd-white" role="progressbar" aria-valuenow="10" aria-valuemin="0" aria-valuemax="100"></div>
                        <div class="progress-bar bg-purple wd-5p bd-l bd-white" role="progressbar" aria-valuenow="10" aria-valuemin="0" aria-valuemax="100"></div>
                      </div>

                      <table class="table-dashboard-two">
                        <tbody>
                          
                          {% for service in service %}
                              <tr>
                                {% if current_user.role.role == "Chef de département" %}
                                  {% if (service.note_qualite_interne*100) > 80 %}
                                  <td><div class="wd-12 ht-12 rounded-circle bd bd-3 bd-success"></div></td>
                                  {% elif (service.note_qualite_interne*100) <= 80 %}
                                  <td><div class="wd-12 ht-12 rounded-circle bd bd-3 bd-primary"></div></td>
                                  {% elif (service.note_qualite_interne*100) <= 60 %}
                                  <td><div class="wd-12 ht-12 rounded-circle bd bd-3 bd-warning"></div></td>
                                  {% elif (service.note_qualite_interne*100) <= 10 %}
                                  
                                  <td><div class="wd-12 ht-12 rounded-circle bd bd-3 bd-pink"></div></td>
                                  {% endif %}
                                  <td class="tx-medium">{{ service.service_nom }}</td>
                                  <td class="text-right">{{ service.total_tickets }}</td>
                                  <td class="text-right">{{ (service.note_qualite_interne*100)|round(1) }}%</td>
                                {% elif service.service_nom == current_user.service.nom  and current_user.role.role == "Chef de Service" %}
                                    {% if (service.note_qualite_interne*100) > 80 %}
                                    <td><div class="wd-12 ht-12 rounded-circle bd bd-3 bd-success"></div></td>
                                    {% elif (service.note_qualite_interne*100) <= 80 %}
                                    <td><div class="wd-12 ht-12 rounded-circle bd bd-3 bd-primary"></div></td>
                                    {% elif (service.note_qualite_interne*100) <= 60 %}
                                    <td><div class="wd-12 ht-12 rounded-circle bd bd-3 bd-warning"></div></td>
                                    {% elif (service.note_qualite_interne*100) <= 10 %}
                                    
                                    <td><div class="wd-12 ht-12 rounded-circle bd bd-3 bd-pink"></div></td>
                                    {% endif %}
                                    <td class="tx-medium">{{ service.service_nom }}</td>
                                    <td class="text-right">{{ service.total_tickets }}</td>
                                    <td class="text-right">{{ (service.note_qualite_interne*100)|round(1) }}%</td>
                                
                                {% endif %}
                              </tr>
                            
                            {% endfor %}
                            {% for agent in agents %}
                              {% if current_user.role.role == "Agent" or (current_user.role.role == "Chef de Service") or current_user.role.role == "Collaborateur" %}
                                {% if agent.agent_nom_abrege.split('_')[0] == current_user.service.nom %}
                                    <tr>
                                        {% if (agent.note_qualite_interne*100) > 80 %}
                                            <td><div class="wd-12 ht-12 rounded-circle bd bd-3 bd-success"></div></td>
                                        {% elif (agent.note_qualite_interne*100) <= 80 and (agent.note_qualite_interne*100) > 60 %}
                                            <td><div class="wd-12 ht-12 rounded-circle bd bd-3 bd-primary"></div></td>
                                        {% elif (agent.note_qualite_interne*100) <= 60 and (agent.note_qualite_interne*100) > 10 %}
                                            <td><div class="wd-12 ht-12 rounded-circle bd bd-3 bd-warning"></div></td>
                                        {% elif (agent.note_qualite_interne*100) <= 10 %}
                                            <td><div class="wd-12 ht-12 rounded-circle bd bd-3 bd-pink"></div></td>
                                        {% endif %}
                                        <td class="tx-medium">{{ agent.agent_nom_abrege }}</td>
                                        <td class="text-right">{{ agent.total_tickets }}</td>
                                        <td class="text-right">{{ (agent.note_qualite_interne*100)|round(1) }}%</td>
                                    </tr>
                                {% endif %}
                              {% endif %}
                          {% endfor %}
                          <!-- <tr>
                            <td class="tx-medium">ISCL</td>
                            <td class="text-right">1,674</td>
                            <td class="text-right">25%</td>
                          </tr>
                          <tr>
                            <td class="tx-medium">Good</td>
                            <td class="text-right">125</td>
                            <td class="text-right">6%</td>
                          </tr>
                          <tr>
                            <td class="tx-medium">Fair</td>
                            <td class="text-right">98</td>
                            <td class="text-right">5%</td>
                          </tr>
                          <tr>
                            <td><div class="wd-12 ht-12 rounded-circle bd bd-3 bd-teal"></div></td>
                            <td class="tx-medium">Poor</td>
                            <td class="text-right">512</td>
                            <td class="text-right">10%</td>
                          </tr>
                          <tr>
                            <td><div class="wd-12 ht-12 rounded-circle bd bd-3 bd-purple"></div></td>
                            <td class="tx-medium">Very Poor</td>
                            <td class="text-right">81</td>
                            <td class="text-right">4%</td>
                          </tr> -->
                        </tbody>
                      </table>
                    </div><!-- card-body -->
                  </div><!-- card -->
                </div>
                <div class="col-md-6 mg-t-10">
                  <div class="card">
                    <div class="card-header pd-b-0 pd-x-20 bd-b-0">
                      <div class="d-sm-flex align-items-center justify-content-between">
                        <h6 class="mg-b-0">Recent Activities</h6>
                        <p class="tx-12 tx-color-03 mg-b-0">Last activity: 2 hours ago</p>
                      </div>
                    </div><!-- card-header -->
                    <div class="card-body pd-20">
                      <ul class="activity tx-13">
                        {% for trans in trans %}
                          <li class="activity-item">
                            <div class="activity-icon bg-primary-light tx-primary">
                              <i data-feather="clock"></i>
                            </div>
                            <div class="activity-body">
                              <p class="mg-b-2"><strong>{{ trans. users_transac }}</strong> added a time entry to the ticket <a href="" class="link-02"><strong>Sales Revenue</strong></a></p>
                              <small class="tx-color-03">{{ trans.heure }}2 hours ago</small>
                            </div><!-- activity-body -->
                          </li><!-- activity-item -->
                          <!-- <li class="activity-item">
                            <div class="activity-icon bg-success-light tx-success">
                              <i data-feather="paperclip"></i>
                            </div>
                            <div class="activity-body">
                              <p class="mg-b-2"><strong>Kevin</strong> added new attachment to the ticket <a href="" class="link-01"><strong>Software Bug Reporting</strong></a></p>
                              <small class="tx-color-03">5 hours ago</small>
                            </div>
                          </li>
                        
                          <li class="activity-item">
                            <div class="activity-icon bg-warning-light tx-orange">
                              <i data-feather="share"></i>
                            </div>
                            <div class="activity-body">
                              <p class="mg-b-2"><strong>Natalie</strong> reassigned ticket <a href="" class="link-02"><strong>Problem installing software</strong></a> to <strong>Katherine</strong></p>
                              <small class="tx-color-03">8 hours ago</small>
                            </div>
                          </li> -->
                        {% endfor %}
                        <!-- activity-item -->
                        <!-- <li class="activity-item">
                          <div class="activity-icon bg-pink-light tx-pink">
                            <i data-feather="plus-circle"></i>
                          </div>
                          <div class="activity-body">
                            <p class="mg-b-2"><strong>Katherine</strong> submitted new ticket <a href="" class="link-02"><strong>Payment Method</strong></a></p>
                            <small class="tx-color-03">Yesterday</small>
                          </div>
                        </li>
                        <li class="activity-item">
                          <div class="activity-icon bg-indigo-light tx-indigo">
                            <i data-feather="settings"></i>
                          </div>
                          <div class="activity-body">
                            <p class="mg-b-2"><strong>Katherine</strong> changed settings to ticket category <a href="" class="link-02"><strong>Payment &amp; Invoice</strong></a></p>
                            <small class="tx-color-03">2 days ago</small>
                          </div>
                        </li> -->
                        <!-- activity-item -->
                      </ul><!-- activity -->
                    </div><!-- card-body -->
                  </div><!-- card -->
                </div>
                <div class="col-md-6 mg-t-10">
                  <div class="card">
                    <div class="card-header pd-b-0 pd-x-20 bd-b-0">
                      <h6 class="mg-b-0">Agent Performance Points</h6>
                    </div><!-- card-header -->
                    <div class="card-body pd-t-25">
                      <!--  -->
                      {% for agent in agents %}
                      {% if agent.agent_nom_abrege.split('_')[0] == current_user.service.nom  and current_user.role.role == "Chef de Service" %}
                      
                      <div class="media">
                        <div class="avatar"><img src="https://placehold.co/500" class="rounded-circle" alt=""></div>
                        <div class="media-body mg-l-15">
                          <h6 class="tx-13 mg-b-2">{{ agent.agent_nom_abrege }}</h6>
                          <p class="tx-color-03 tx-12 mg-b-10">{{ agent.total_defauts }} défauts</p>
                          <div class="progress ht-4 op-7 mg-b-5">
                            {% if 0 <= agent.total_tickets < 55 %}
                            <div class="progress-bar wd-{{ agent.total_tickets }}p" role="progressbar" aria-valuenow="{{ agent.total_tickets }}" aria-valuemin="0" aria-valuemax="100"></div>
                            {% elif 55 <= agent.total_tickets < 65 %}
                            <div class="progress-bar bg-success wd-{{ agent.total_tickets }}p" role="progressbar" aria-valuenow="{{ agent.total_tickets }}" aria-valuemin="0" aria-valuemax="100"></div>
                            {% elif 65 <= agent.total_tickets < 101 %}
                            <div class="progress-bar bg-pink wd-{{ agent.total_tickets }}p" role="progressbar" aria-valuenow="{{ agent.total_tickets }}" aria-valuemin="0" aria-valuemax="100"></div>
                            {% endif %}
                          </div>
                          <div class="d-flex justify-content-between tx-12">
                            <span class="tx-color-03">Executive Level</span>
                            <strong class="tx-medium">{{ agent.total_tickets }} tickets</strong>
                          </div>
                        </div><!-- media-body -->
                      </div><!-- media -->
                      {% endif %}
                      {% endfor %}
                      {% if current_user.role.role == "Agent" or current_user.role.role == "Collaborateur" or  current_user.role.role == "Chef de département" %}

                        {% for agent in order_by %}
                        <div class="media">
                          <div class="avatar"><img src="https://placehold.co/500" class="rounded-circle" alt=""></div>
                          <div class="media-body mg-l-15">
                            <h6 class="tx-13 mg-b-2">{{ agent.agent_nom_abrege }}</h6>
                            <p class="tx-color-03 tx-12 mg-b-10">{{ agent.total_defauts }} défauts</p>
                            <div class="progress ht-4 op-7 mg-b-5">
                              {% if 0 <= agent.total_tickets < 55 %}
                              <div class="progress-bar wd-{{ agent.total_tickets }}p" role="progressbar" aria-valuenow="{{ agent.total_tickets }}" aria-valuemin="0" aria-valuemax="100"></div>
                              {% elif 55 <= agent.total_tickets <= 65 %}
                              <div class="progress-bar bg-pink wd-{{ agent.total_tickets }}p" role="progressbar" aria-valuenow="{{ agent.total_tickets }}" aria-valuemin="0" aria-valuemax="100"></div>
                              {% elif 65 <= agent.total_tickets < 101 %}
                              <div class="progress-bar bg-success wd-{{ agent.total_tickets }}p" role="progressbar" aria-valuenow="{{ agent.total_tickets }}" aria-valuemin="0" aria-valuemax="100"></div>
                              {% endif %}
                            </div>
                            <div class="d-flex justify-content-between tx-12">
                              <span class="tx-color-03">Executive Level</span>
                              <strong class="tx-medium">{{ agent.total_tickets }} tickets</strong>
                            </div>
                          </div><!-- media-body -->
                        </div><!-- media -->
                        {% endfor %}
                      
                      {% endif %}
                      <!--  -->
                    </div><!-- card-body -->
                  </div><!-- card -->
                </div>
              </div><!-- row -->
            </div><!-- col -->
            <div class="col-lg-4 mg-t-10 mg-lg-t-0">
              <div class="row row-xs">
                <div class="col-12 col-md-6 col-lg-12">
                  <div class="card card-body">
                    <div class="media d-block d-sm-flex align-items-center">
                      <div class="d-inline-block pos-relative">
                        <span class="peity-donut" data-peity='{ "fill": ["#65e0e0","#e5e9f2"], "height": 110, "width": 110, "innerRadius": 46 }'>70,30</span>

                        <div class="pos-absolute a-0 d-flex flex-column align-items-center justify-content-center">
                          <h3 class="tx-rubik tx-spacing--1 mg-b-0">86%</h3>
                          <span class="tx-9 tx-semibold tx-sans tx-color-03 tx-uppercase">Reached</span>
                        </div>
                      </div>
                      <div class="media-body mg-t-20 mg-sm-t-0 mg-sm-l-20">
                        <h6 class="mg-b-5">Time to Resolved Complaint</h6>
                        <p class="lh-4 tx-12 tx-color-03 mg-b-15">The average time taken to resolve complaints.</p>
                        <h3 class="tx-spacing--1 mg-b-0">7m:32s <small class="tx-13 tx-color-03">/ Goal: 8m:0s</small></h3>
                      </div><!-- media-body -->
                    </div><!-- media -->
                  </div>
                </div><!-- col -->
                <div class="col-12 col-md-6 col-lg-12 mg-t-10 mg-md-t-0 mg-lg-t-10">
                  <div class="card card-body">
                    <div class="media d-block d-sm-flex align-items-center">
                      <div class="d-inline-block pos-relative">
                        <span class="peity-donut" data-peity='{ "fill": ["#69b2f8","#e5e9f2"], "height": 110, "width": 110, "innerRadius": 46 }'>69,31</span>

                        <div class="pos-absolute a-0 d-flex flex-column align-items-center justify-content-center">
                          <h3 class="tx-rubik tx-spacing--1 mg-b-0">69%</h3>
                          <span class="tx-9 tx-semibold tx-sans tx-color-03 tx-uppercase">Reached</span>
                        </div>
                      </div>
                      <div class="media-body mg-t-20 mg-sm-t-0 mg-sm-l-20">
                        <h6 class="mg-b-5">Average Speed of Answer</h6>
                        <p class="lh-4 tx-12 tx-color-03 mg-b-15">Measure how quickly support staff answer incoming calls.</p>
                        <h3 class="tx-spacing--1 mg-b-0">0m:20s <small class="tx-13 tx-color-03">/ Goal: 0m:10s</small></h3>
                      </div><!-- media-body -->
                    </div><!-- media -->
                  </div>
                </div><!-- col -->
                <div class="col-12 col-md-6 col-lg-12 mg-t-10">
                  <div class="card">
                    <div class="card-header pd-t-20 pd-b-0 bd-b-0 d-flex justify-content-between">
                      <h6 class="lh-5 mg-b-0">Complaints Received</h6>
                      <a href="" class="tx-13 link-03 d-flex align-items-center gap-1">This Month <ion-icon name="chevron-down-outline" class="tx-12"></ion-icon></a>
                    </div><!-- card-header -->
                    <div class="card-body pd-0 pos-relative">
                      <div class="pos-absolute t-10 l-20 z-index-10">
                        <div class="d-flex align-items-baseline">
                          <h1 class="tx-normal tx-rubik mg-b-0 mg-r-5">{{ tous_tickets }}</h1>
                          <p class="tx-11 tx-color-03 mg-b-0"><span class="tx-medium tx-success d-inline-flex align-items-center">0.3% <ion-icon name="arrow-down-outline" class="mg-b-2"></ion-icon></span> than last month</p>
                        </div>
                        <p class="tx-12 tx-color-03 wd-60p">Le nombre de total de tickets reçus dans ce mois.</p>
                      </div>

                      <div class="chart-sixteen">
                        <div id="flotChart2" class="flot-chart"></div>
                      </div>
                    </div><!-- card-body -->
                  </div><!-- card -->
                </div><!-- col -->
                <div class="col-12 col-md-6 col-lg-12 mg-t-10">
                  <div class="card">
                    <div class="card-header pd-t-20 pd-b-0 bd-b-0">
                      <h6 class="lh-5 mg-b-5">Overall Rating</h6>
                      <p class="tx-12 tx-color-03 mg-b-0">Measures the quality or your support team’s efforts.</p>
                    </div><!-- card-header -->
                    <div class="card-body pd-0">
                      <!-- Service Perf -->
                      <div class="pd-t-10 pd-b-15 pd-x-20 d-flex align-items-baseline">
                        <h1 class="tx-normal tx-rubik mg-b-0 mg-r-5">4.2</h1>
                        <div class="tx-18">
                          <ion-icon name="star" class="lh-0 tx-orange"></ion-icon>
                          <ion-icon name="star" class="lh-0 tx-orange"></ion-icon>
                          <ion-icon name="star" class="lh-0 tx-orange"></ion-icon>
                          <ion-icon name="star" class="lh-0 tx-orange"></ion-icon>
                          <ion-icon name="star" class="lh-0 tx-gray-300"></ion-icon>
                        </div>
                      </div>
                      <div class="list-group list-group-flush tx-13">
                        <!-- Par agent -->
                        {% for agent in QI %}
                        {% if agent.agent_nom_abrege.split('_')[0] == current_user.service.nom  and current_user.role.role == "Chef de Service" %}

                          {% if agent.note_qualite_interne >0.90 %}
                          <div class="list-group-item pd-y-5 pd-x-20 d-flex align-items-center">
                            <strong class="tx-12 tx-rubik">5.0</strong>
                            <div class="tx-16 mg-l-10 mg-t-5">
                              <ion-icon name="star" class="lh-0 tx-orange"></ion-icon>
                              <ion-icon name="star" class="lh-0 tx-orange"></ion-icon>
                              <ion-icon name="star" class="lh-0 tx-orange"></ion-icon>
                              <ion-icon name="star" class="lh-0 tx-orange"></ion-icon>
                              <ion-icon name="star" class="lh-0 tx-orange"></ion-icon>
                            </div>
                            <div class="mg-l-auto tx-rubik tx-color-02">{{ agent.agent_nom_abrege }}</div>
                            <div class="mg-l-20 tx-rubik tx-color-03 wd-10p text-right">{{ agent.note_qualite_interne}}</div>
                          </div>
                          {% elif agent.note_qualite_interne >0.80 %}
                          <div class="list-group-item pd-y-5 pd-x-20 d-flex align-items-center">
                            <strong class="tx-12 tx-rubik">4.0</strong>
                            <div class="tx-16 mg-l-10 mg-t-5">
                              <ion-icon name="star" class="lh-0 tx-orange"></ion-icon>
                              <ion-icon name="star" class="lh-0 tx-orange"></ion-icon>
                              <ion-icon name="star" class="lh-0 tx-orange"></ion-icon>
                              <ion-icon name="star" class="lh-0 tx-orange"></ion-icon>
                              <ion-icon name="star" class="lh-0 tx-gray-300"></ion-icon>
                            </div>
                            <div class="mg-l-auto tx-rubik tx-color-02">{{ agent.agent_nom_abrege }}</div>
                            <div class="mg-l-20 tx-rubik tx-color-03 wd-10p text-right">{{ agent.note_qualite_interne}}</div>
                          </div>
                          {% elif agent.note_qualite_interne >0.60 %}
                          <div class="list-group-item pd-y-5 pd-x-20 d-flex align-items-center">
                            <strong class="tx-12 tx-rubik">3.0</strong>
                            <div class="tx-16 mg-l-10 mg-t-5">
                              <ion-icon name="star" class="lh-0 tx-orange"></ion-icon>
                              <ion-icon name="star" class="lh-0 tx-orange"></ion-icon>
                              <ion-icon name="star" class="lh-0 tx-orange"></ion-icon>
                              <ion-icon name="star" class="lh-0 tx-gray-300"></ion-icon>
                              <ion-icon name="star" class="lh-0 tx-gray-300"></ion-icon>
                            </div>
                            <div class="mg-l-auto tx-rubik tx-color-02">{{ agent.agent_nom_abrege }}</div>
                            <div class="mg-l-20 tx-rubik tx-color-03 wd-10p text-right">{{ agent.note_qualite_interne}}</div>
                          </div>
                          {% elif agent.note_qualite_interne >0.40 %}
                          <div class="list-group-item pd-y-5 pd-x-20 d-flex align-items-center">
                            <strong class="tx-12 tx-rubik">2.0</strong>
                            <div class="tx-16 mg-l-10 mg-t-5">
                              <ion-icon name="star" class="lh-0 tx-orange"></ion-icon>
                              <ion-icon name="star" class="lh-0 tx-orange"></ion-icon>
                              <ion-icon name="star" class="lh-0 tx-gray-300"></ion-icon>
                              <ion-icon name="star" class="lh-0 tx-gray-300"></ion-icon>
                              <ion-icon name="star" class="lh-0 tx-gray-300"></ion-icon>
                            </div>
                            <div class="mg-l-auto tx-rubik tx-color-02">{{ agent.agent_nom_abrege }}</div>
                            <div class="mg-l-20 tx-rubik tx-color-03 wd-10p text-right">{{ agent.note_qualite_interne}}</div>
                          </div>
                          {% elif agent.note_qualite_interne < 0.40  %}
                          <div class="list-group-item pd-y-5 pd-x-20 d-flex align-items-center bg-transparent">
                            <strong class="tx-12 tx-rubik">1.0</strong>
                            <div class="tx-16 mg-l-10 mg-t-5">
                              <ion-icon name="star" class="lh-0 tx-orange"></ion-icon>
                              <ion-icon name="star" class="lh-0 tx-gray-300"></ion-icon>
                              <ion-icon name="star" class="lh-0 tx-gray-300"></ion-icon>
                              <ion-icon name="star" class="lh-0 tx-gray-300"></ion-icon>
                              <ion-icon name="star" class="lh-0 tx-gray-300"></ion-icon>
                            </div>
                            <div class="mg-l-auto tx-rubik tx-color-02">{{ agent.agent_nom_abrege }}</div>
                            <div class="mg-l-20 tx-rubik tx-color-03 wd-10p text-right">{{ agent.note_qualite_interne }}</div>
                          </div>
                          {% endif %}

                        {% elif current_user.role.role == "Chef de département" %}

                            {% if agent.note_qualite_interne >0.90 %}
                            <div class="list-group-item pd-y-5 pd-x-20 d-flex align-items-center">
                              <strong class="tx-12 tx-rubik">5.0</strong>
                              <div class="tx-16 mg-l-10 mg-t-5">
                                <ion-icon name="star" class="lh-0 tx-orange"></ion-icon>
                                <ion-icon name="star" class="lh-0 tx-orange"></ion-icon>
                                <ion-icon name="star" class="lh-0 tx-orange"></ion-icon>
                                <ion-icon name="star" class="lh-0 tx-orange"></ion-icon>
                                <ion-icon name="star" class="lh-0 tx-orange"></ion-icon>
                              </div>
                              <div class="mg-l-auto tx-rubik tx-color-02">{{ agent.agent_nom_abrege }}</div>
                              <div class="mg-l-20 tx-rubik tx-color-03 wd-10p text-right">{{ agent.note_qualite_interne}}</div>
                            </div>
                            {% elif agent.note_qualite_interne >0.80 %}
                            <div class="list-group-item pd-y-5 pd-x-20 d-flex align-items-center">
                              <strong class="tx-12 tx-rubik">4.0</strong>
                              <div class="tx-16 mg-l-10 mg-t-5">
                                <ion-icon name="star" class="lh-0 tx-orange"></ion-icon>
                                <ion-icon name="star" class="lh-0 tx-orange"></ion-icon>
                                <ion-icon name="star" class="lh-0 tx-orange"></ion-icon>
                                <ion-icon name="star" class="lh-0 tx-orange"></ion-icon>
                                <ion-icon name="star" class="lh-0 tx-gray-300"></ion-icon>
                              </div>
                              <div class="mg-l-auto tx-rubik tx-color-02">{{ agent.agent_nom_abrege }}</div>
                              <div class="mg-l-20 tx-rubik tx-color-03 wd-10p text-right">{{ agent.note_qualite_interne}}</div>
                            </div>
                            {% elif agent.note_qualite_interne >0.60 %}
                            <div class="list-group-item pd-y-5 pd-x-20 d-flex align-items-center">
                              <strong class="tx-12 tx-rubik">3.0</strong>
                              <div class="tx-16 mg-l-10 mg-t-5">
                                <ion-icon name="star" class="lh-0 tx-orange"></ion-icon>
                                <ion-icon name="star" class="lh-0 tx-orange"></ion-icon>
                                <ion-icon name="star" class="lh-0 tx-orange"></ion-icon>
                                <ion-icon name="star" class="lh-0 tx-gray-300"></ion-icon>
                                <ion-icon name="star" class="lh-0 tx-gray-300"></ion-icon>
                              </div>
                              <div class="mg-l-auto tx-rubik tx-color-02">{{ agent.agent_nom_abrege }}</div>
                              <div class="mg-l-20 tx-rubik tx-color-03 wd-10p text-right">{{ agent.note_qualite_interne}}</div>
                            </div>
                            {% elif agent.note_qualite_interne >0.40 %}
                            <div class="list-group-item pd-y-5 pd-x-20 d-flex align-items-center">
                              <strong class="tx-12 tx-rubik">2.0</strong>
                              <div class="tx-16 mg-l-10 mg-t-5">
                                <ion-icon name="star" class="lh-0 tx-orange"></ion-icon>
                                <ion-icon name="star" class="lh-0 tx-orange"></ion-icon>
                                <ion-icon name="star" class="lh-0 tx-gray-300"></ion-icon>
                                <ion-icon name="star" class="lh-0 tx-gray-300"></ion-icon>
                                <ion-icon name="star" class="lh-0 tx-gray-300"></ion-icon>
                              </div>
                              <div class="mg-l-auto tx-rubik tx-color-02">{{ agent.agent_nom_abrege }}</div>
                              <div class="mg-l-20 tx-rubik tx-color-03 wd-10p text-right">{{ agent.note_qualite_interne}}</div>
                            </div>
                            {% else %}
                            <div class="list-group-item pd-y-5 pd-x-20 d-flex align-items-center bg-transparent">
                              <strong class="tx-12 tx-rubik">1.0</strong>
                              <div class="tx-16 mg-l-10 mg-t-5">
                                <ion-icon name="star" class="lh-0 tx-orange"></ion-icon>
                                <ion-icon name="star" class="lh-0 tx-gray-300"></ion-icon>
                                <ion-icon name="star" class="lh-0 tx-gray-300"></ion-icon>
                                <ion-icon name="star" class="lh-0 tx-gray-300"></ion-icon>
                                <ion-icon name="star" class="lh-0 tx-gray-300"></ion-icon>
                              </div>
                              <div class="mg-l-auto tx-rubik tx-color-02">{{ agent.agent_nom_abrege }}</div>
                              <div class="mg-l-20 tx-rubik tx-color-03 wd-10p text-right">{{ agent.note_qualite_interne }}</div>
                            </div>
                            {% endif %}
                        {% endif %}

                        
                        {% endfor %}
                      </div><!-- list-group -->
                    </div><!-- card-body -->
                  </div><!-- card -->
                </div><!-- col -->
                <div class="col-12 col-md-6 col-lg-12 mg-t-10">
                  <div class="card">
                    <div class="card-header d-flex align-items-center justify-content-between pd-r-15">
                      <h6 class="mg-b-0">Transaction History</h6>
                      <div class="d-flex tx-16">
                        <a href="" class="link-03 lh-0"><ion-icon name="refresh-outline"></ion-icon></a>
                        <a href="" class="link-03 lh-0 mg-l-5"><ion-icon name="ellipsis-vertical"></ion-icon></a>
                      </div>
                    </div>
                    <ul class="list-group list-group-flush tx-13">
                      <li class="list-group-item d-flex pd-sm-x-20">
                        <div class="avatar d-none d-sm-block"><span class="avatar-initial rounded-circle bg-indigo op-5"><ion-icon name="return-down-back"></ion-icon></span></div>
                        <div class="pd-sm-l-10">
                          <p class="tx-medium mg-b-2">Process refund to #00910</p>
                          <small class="tx-12 tx-color-03 mg-b-0">Mar 21, 2023, 1:00pm</small>
                        </div>
                        <div class="mg-l-auto text-right">
                          <p class="tx-medium mg-b-2">-$16.50</p>
                          <small class="tx-12 tx-success mg-b-0">Completed</small>
                        </div>
                      </li>
                      <li class="list-group-item d-flex pd-sm-x-20">
                        <div class="avatar d-none d-sm-block"><span class="avatar-initial rounded-circle bg-orange op-5"><ion-icon name="bus-outline"></ion-icon></span></div>
                        <div class="pd-sm-l-10">
                          <p class="tx-medium mg-b-2">Process delivery to #44333</p>
                          <small class="tx-12 tx-color-03 mg-b-0">Mar 20, 2023, 11:40am</small>
                        </div>
                        <div class="mg-l-auto text-right">
                          <p class="tx-medium mg-b-2">3 Items</p>
                          <small class="tx-12 tx-info mg-b-0">For pickup</small>
                        </div>
                      </li>
                      <li class="list-group-item d-flex pd-sm-x-20">
                        <div class="avatar d-none d-sm-block"><span class="avatar-initial rounded-circle bg-teal"><ion-icon name="checkmark-outline"></ion-icon></span></div>
                        <div class="pd-sm-l-10">
                          <p class="tx-medium mg-b-0">Payment from #023328</p>
                          <small class="tx-12 tx-color-03 mg-b-0">Mar 20, 2023, 10:30pm</small>
                        </div>
                        <div class="mg-l-auto text-right">
                          <p class="tx-medium mg-b-0">+ $129.50</p>
                          <small class="tx-12 tx-success mg-b-0">Completed</small>
                        </div>
                      </li>
                      <li class="list-group-item d-flex pd-sm-x-20">
                        <div class="avatar d-none d-sm-block"><span class="avatar-initial rounded-circle bg-gray-400"><ion-icon name="close-outline"></ion-icon></span></div>
                        <div class="pd-sm-l-10">
                          <p class="tx-medium mg-b-0">Payment failed from #087651</p>
                          <small class="tx-12 tx-color-03 mg-b-0">Mar 19, 2023, 12:54pm</small>
                        </div>
                        <div class="mg-l-auto text-right">
                          <p class="tx-medium mg-b-0">$150.00</p>
                          <small class="tx-12 tx-danger mg-b-0">Declined</small>
                        </div>
                      </li>
                    </ul>
                    <div class="card-footer text-center tx-13">
                      <a href="" class="link-03 d-inline-flex align-items-center">View All Transactions <ion-icon name="arrow-down-outline" class="tx-12 mg-b-1 mg-l-3"></ion-icon></a>
                    </div><!-- card-footer -->
                  </div><!-- card -->
                </div><!-- col -->
              </div><!-- row -->
            </div><!-- col -->
          </div>
        </div>

    <script src="../static/lib/jquery/jquery.min.js"></script>
    <script src="../static/lib/bootstrap/js/bootstrap.bundle.min.js"></script>
    <script src="../static/lib/feather-icons/feather.min.js"></script>
    <script src="../static/lib/ionicons/ionicons/ionicons.esm.js" type="module"></script>
    <script src="../static/lib/perfect-scrollbar/perfect-scrollbar.min.js"></script>
    <script src="../static/lib/jquery.flot/jquery.flot.js"></script>
    <script src="../static/lib/jquery.flot/jquery.flot.stack.js"></script>
    <script src="../static/lib/jquery.flot/jquery.flot.resize.js"></script>
    <script src="../static/lib/flot.curvedlines/curvedLines.js"></script>
    <script src="../static/lib/peity/jquery.peity.min.js"></script>
    <script src="../static/lib/chart.js/Chart.bundle.min.js"></script>

    <script src="../static/assets/js/dashforge.js"></script>
    <script src="../static/assets/js/dashforge.aside.js"></script>
    <script src="../static/assets/js/dashforge.sampledata.js"></script>
    <script src="../static/assets/js/dashboard-four.js"></script>

    <!-- append theme customizer -->
    <script src="../static/lib/js-cookie/js.cookie.js"></script>
    <script src="../static/assets/js/dashforge.settings.js"></script>


{% endblock content %}
